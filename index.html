<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Travel App - Designed by isonnn</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root { --primary-red: #C41E3A; --bg: #F5F7FA; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 120px; color: #333; -webkit-tap-highlight-color: transparent; }
        
        /* Header åŒºåŸŸï¼šåŒ…å«ä½è°ƒç­¾å */
        header { background: #fff; padding: 20px 25px; border-top: 10px solid var(--primary-red); position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        header h1 { margin: 0; font-size: 1.4rem; color: #1a1a1a; font-weight: 800; }
        .subtitle-row { display: flex; justify-content: space-between; align-items: baseline; margin-top: 5px; }
        header p { margin: 0; color: #888; font-size: 0.9rem; font-weight: 500; }
        .credit-tag { font-size: 0.65rem; color: #ddd; font-style: italic; font-weight: 400; }

        /* è¡Œç¨‹é¡µé¢å¡ç‰‡æ ·å¼ */
        .day-card { background: white; border-radius: 12px; margin: 15px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.02); }
        .card-header { display: flex; height: 80px; cursor: pointer; }
        .header-left { background: var(--primary-red); color: white; width: 70px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .day-num { font-size: 1.4rem; font-weight: 900; }
        .day-date { font-size: 0.75rem; opacity: 0.9; }
        .header-right { flex: 1; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; }
        .day-info h3 { margin: 0; font-size: 1.1rem; font-weight: 700; }
        
        .card-body { display: none; padding: 20px; border-top: 1px solid #f8f8f8; }
        .day-card.open .card-body { display: block; }
        .day-card.open .fa-chevron-down { transform: rotate(180deg); color: var(--primary-red); }

        /* æ—¶é—´çº¿æ ·å¼ */
        .timeline-item { position: relative; padding-left: 25px; border-left: 2px solid #eee; padding-bottom: 25px; }
        .timeline-item:last-child { border-left-color: transparent; }
        .timeline-dot { position: absolute; left: -7px; top: 2px; width: 12px; height: 12px; background: white; border: 3px solid var(--primary-red); border-radius: 50%; }
        .event-time { font-weight: 700; color: var(--primary-red); font-size: 0.85rem; font-family: monospace; }
        .event-title { font-weight: 800; font-size: 1rem; margin: 4px 0; color: #222; }
        .event-remark { font-size: 0.85rem; color: #666; line-height: 1.5; background: #f9f9f9; padding: 10px; border-radius: 6px; margin-top: 8px; }
        
        /* å¯¼èˆªæŒ‰é’®æ ·å¼ */
        .nav-btn { display: inline-flex; align-items: center; gap: 5px; background: #fff; border: 1px solid #eee; padding: 8px 16px; border-radius: 20px; font-size: 0.75rem; text-decoration: none; color: #333; font-weight: 600; margin-top: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }

        /* åº•éƒ¨å¯¼èˆªæ  */
        .tab-bar { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 75%; max-width: 320px; background: white; border-radius: 50px; display: flex; padding: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); z-index: 1000; }
        .tab-item { flex: 1; text-align: center; color: #aaa; padding: 8px 0; border-radius: 30px; font-size: 0.75rem; font-weight: bold; display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .tab-item.active { background: #FEE8EC; color: var(--primary-red); }
        .tab-icon { font-size: 1.1rem; }

        /* åŠ è½½çŠ¶æ€ */
        .loading { text-align: center; padding: 100px 0; color: #999; font-size: 0.9rem; }
    </style>
</head>
<body>

    <header>
        <h1 id="app-title">æ­£åœ¨åŠ è½½...</h1>
        <div class="subtitle-row">
            <p id="app-subtitle">åŒæ­¥äº‘ç«¯æ•°æ®ä¸­</p>
            <span class="credit-tag">Designed by isonnn</span>
        </div>
    </header>

    <div id="itinerary-page">
        <div id="itinerary-container" class="loading">
            <i class="fas fa-sync fa-spin"></i><br><br>æ­£åœ¨ä» Google Sheet åŒæ­¥æœ€æ–°è¡Œç¨‹...
        </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active">
            <span class="tab-icon">ğŸ“…</span>
            <span>è¡Œç¨‹</span>
        </div>
        <div class="tab-item" onclick="alert('é…’åº—æ¨¡å—å¼€å‘ä¸­...')">
            <span class="tab-icon">ğŸ¨</span>
            <span>é…’åº—</span>
        </div>
        <div class="tab-item" onclick="alert('è®°è´¦æ¨¡å—å¼€å‘ä¸­...')">
            <span class="tab-icon">ğŸ’°</span>
            <span>è®°è´¦</span>
        </div>
    </div>

    <script>
        // === è¯·åŠ¡å¿…æ›¿æ¢ä»¥ä¸‹é“¾æ¥ä¸ºä½ å‘å¸ƒçš„ CSV é“¾æ¥ ===
        const csvUrl = 'ä½ çš„_CSV_å‘å¸ƒé“¾æ¥_å¡«åœ¨è¿™é‡Œ';

        window.onload = function() { fetchItinerary(); };

        function fetchItinerary() {
            Papa.parse(csvUrl, {
                download: true,
                complete: function(results) {
                    const data = results.data;
                    
                    // 1. è®¾ç½®ä¸»å‰¯æ ‡é¢˜
                    // B1 = APP TITLE, B2 = SUBTITLE
                    document.getElementById('app-title').innerText = data[0][1] || "Travel App";
                    document.getElementById('app-subtitle').innerText = data[1][1] || "My Trip";
                    
                    // 2. æ ¸å¿ƒé€»è¾‘ï¼šè§£ææ•°æ®è¡Œ (è·³è¿‡å‰ 4 è¡Œæ ‡é¢˜)
                    const rows = data.slice(4);
                    const groupedDays = groupItinerary(rows);
                    renderItinerary(groupedDays);
                },
                error: function() {
                    document.getElementById('itinerary-container').innerHTML = "âš ï¸ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ Google Sheet å‘å¸ƒè®¾ç½®ã€‚";
                }
            });
        }

        // --- é€»è¾‘ï¼šè‡ªåŠ¨å½’çº³ Day 1, Day 1 çš„å†…å®¹è‡³åŒä¸€ä¸ªå¡ç‰‡ ---
        function groupItinerary(rows) {
            let daysMap = new Map();

            rows.forEach(row => {
                let dayLabel = row[0]; // Day åˆ— (å¦‚ D1, D2)
                if (!dayLabel || dayLabel.trim() === "") return;

                // å¦‚æœè¯¥ Day ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåˆ›å»ºåŸºç¡€å¡ç‰‡
                if (!daysMap.has(dayLabel)) {
                    daysMap.set(dayLabel, {
                        dayNum: dayLabel,
                        date: row[1],    // Date åˆ—
                        location: row[3], // Location åˆ—
                        events: []
                    });
                }

                // æ·»åŠ å…·ä½“æ´»åŠ¨å†…å®¹ (å·²é€‚é…åˆ é™¤ Description åçš„ç´¢å¼•)
                if (row[4]) { // Activity åˆ—
                    daysMap.get(dayLabel).events.push({
                        time: row[2],     // Time åˆ—
                        activity: row[4], // Activity åˆ—
                        remarks: row[5],  // Remarks åˆ—
                        mapUrl: row[6]    // Map Links åˆ—
                    });
                }
            });
            return Array.from(daysMap.values());
        }

        function renderItinerary(days) {
            const container = document.getElementById('itinerary-container');
            container.innerHTML = '';

            if (days.length === 0) {
                container.innerHTML = "ğŸ“­ æš‚æ— è¡Œç¨‹æ•°æ®ï¼Œè¯·åœ¨è¡¨æ ¼ä¸­å¡«å†™ã€‚";
                return;
            }

            days.forEach(d => {
                const card = document.createElement('div');
                card.className = 'day-card';
                card.onclick = function() { this.classList.toggle('open'); };
                
                let timelineHtml = d.events.map(ev => `
                    <div class="timeline-item">
                        <div class="timeline-dot"></div>
                        <div class="event-time">${ev.time || ''}</div>
                        <div class="event-title">${ev.activity}</div>
                        ${ev.remarks ? `<div class="event-remark">${ev.remarks}</div>` : ''}
                        ${ev.mapUrl && ev.mapUrl !== '123' ? `<a href="${ev.mapUrl}" target="_blank" class="nav-btn"><i class="fas fa-location-arrow"></i> å¯¼èˆª</a>` : ''}
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="card-header">
                        <div class="header-left">
                            <div class="day-num">${d.dayNum}</div>
                            <div class="day-date">${d.date}</div>
                        </div>
                        <div class="header-right">
                            <div class="day-info"><h3>${d.location || 'ä»Šæ—¥è¡Œç¨‹'}</h3></div>
                            <i class="fas fa-chevron-down" style="color:#ddd; transition:0.3s"></i>
                        </div>
                    </div>
                    <div class="card-body">${timelineHtml}</div>
                `;
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
